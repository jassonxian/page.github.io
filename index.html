<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>ä¸ªäººåšå®¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="mzx frontend blog">
<meta property="og:type" content="website">
<meta property="og:title" content="ä¸ªäººåšå®¢">
<meta property="og:url" content="http://www.suner.work/index.html">
<meta property="og:site_name" content="ä¸ªäººåšå®¢">
<meta property="og:description" content="mzx frontend blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="mazhaoxian">
<meta property="article:tag" content="frontend">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="ä¸ªäººåšå®¢" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ä¸ªäººåšå®¢</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">ç”Ÿæ´»å¦‚æ­¤ç®€å•</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS è®¢é˜…"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="æœç´¢"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="æœç´¢"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.suner.work"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-webå‰ç«¯å¼€å‘/hook" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/26/web%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/hook/" class="article-date">
  <time class="dt-published" datetime="2021-03-26T09:34:34.000Z" itemprop="datePublished">2021-03-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/26/web%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/hook/">Reactæ€§èƒ½ä¼˜åŒ–â€”â€”hook</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="ä¸€ã€å‰è¨€"><a href="#ä¸€ã€å‰è¨€" class="headerlink" title="ä¸€ã€å‰è¨€"></a>ä¸€ã€å‰è¨€</h4><p>â€‹        éšç€16.8ç‰ˆæœ¬çš„å‡ºç°ï¼Œreactåˆå¸¦æˆ‘ä»¬å›åˆ°äº†å‡½æ•°å¼ç¼–ç¨‹ï¼Œå…¶çš„å‡ºç°è§£å†³äº†ç±»ç»„ä»¶çš„ä¸è¶³åŒæ—¶å¸¦æ¥äº†ä¸€äº›æ–°ç‰¹æ€§ï¼›æœ¬æ–‡ä¸»è¦å›´ç»•Hookæ‰€æä¾›çš„æ–°ç‰¹æ€§æ¥æŠ›ç –å¼•ç‰æˆ‘ä»¬åœ¨ä½¿ç”¨ç±»ç»„ä»¶çš„æ—¶å€™å¯èƒ½ä»æœªå…³æ³¨è¿‡çš„æ€§èƒ½æ–¹é¢çš„é—®é¢˜ã€‚</p>
<p> ä»€ä¹ˆæ˜¯Hookï¼Ÿ</p>
<blockquote>
<p>å®˜æ–¹æ–‡æ¡£ç»™å‡ºäº†è§£é‡Šï¼šHook æ˜¯ React 16.8 çš„æ–°å¢ç‰¹æ€§ã€‚å®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ã€‚</p>
</blockquote>
<p> åœ¨reactä¸­ï¼Œæ¯å½“æˆ‘ä»¬æ–°é¡µé¢æ‰“å¼€çš„æ—¶å€™ï¼Œçˆ¶ç»„ä»¶ä¸€æ—¦æ›´æ–°ï¼Œå­ç»„ä»¶ä¹Ÿä¼šè·Ÿç€æ›´æ–°ï¼ŒReact æ€§èƒ½ä¼˜åŒ–çš„ç†å¿µçš„ä¸»è¦æ–¹å‘å°±æ˜¯è¿™ä¸¤ä¸ªï¼š    </p>
<ol>
<li>å‡å°‘é‡æ–° render çš„æ¬¡æ•°ã€‚å› ä¸ºåœ¨ React é‡Œæœ€é‡(èŠ±æ—¶é—´æœ€é•¿)çš„ä¸€å—å°±æ˜¯ reconction(ç®€å•çš„å¯ä»¥ç†è§£ä¸º diff)ï¼Œå¦‚æœä¸ renderï¼Œå°±ä¸ä¼š reconctionã€‚</li>
<li>å‡å°‘è®¡ç®—çš„é‡ã€‚ä¸»è¦æ˜¯å‡å°‘é‡å¤è®¡ç®—ï¼Œå¯¹äºå‡½æ•°å¼ç»„ä»¶æ¥è¯´ï¼Œæ¯æ¬¡ render éƒ½ä¼šé‡æ–°ä»å¤´å¼€å§‹æ‰§è¡Œå‡½æ•°è°ƒç”¨ã€‚</li>
</ol>
<p>åœ¨ä½¿ç”¨ç±»ç»„ä»¶çš„æ—¶å€™ï¼Œä½¿ç”¨çš„ React ä¼˜åŒ– API ä¸»è¦æ˜¯ï¼š<code>shouldComponentUpdate</code>å’Œ <code>PureComponent</code>ï¼Œè¿™ä¸¤ä¸ª API æ‰€æä¾›çš„è§£å†³æ€è·¯éƒ½æ˜¯ä¸ºäº†<strong>å‡å°‘é‡æ–° render çš„æ¬¡æ•°</strong>ï¼Œä¸»è¦æ˜¯å‡å°‘çˆ¶ç»„ä»¶æ›´æ–°è€Œå­ç»„ä»¶ä¹Ÿæ›´æ–°çš„æƒ…å†µï¼Œè™½ç„¶ä¹Ÿå¯ä»¥åœ¨ state æ›´æ–°çš„æ—¶å€™é˜»æ­¢å½“å‰ç»„ä»¶æ¸²æŸ“ï¼Œå¦‚æœè¦è¿™ä¹ˆåšçš„è¯ï¼Œè¯æ˜ä½ è¿™ä¸ªå±æ€§ä¸é€‚åˆä½œä¸º stateï¼Œè€Œåº”è¯¥ä½œä¸ºé™æ€å±æ€§æˆ–è€…æ”¾åœ¨ class å¤–é¢ä½œä¸ºä¸€ä¸ªç®€å•çš„å˜é‡ ã€‚</p>
<p>â€‹        ä½†æ˜¯åœ¨å‡½æ•°å¼ç»„ä»¶é‡Œé¢æ²¡æœ‰å£°æ˜å‘¨æœŸä¹Ÿæ²¡æœ‰ç±»ï¼Œé‚£å¦‚ä½•æ¥åšæ€§èƒ½ä¼˜åŒ–å‘¢ï¼Ÿ</p>
<h4 id="äºŒã€-React-memo"><a href="#äºŒã€-React-memo" class="headerlink" title="äºŒã€    React.memo()"></a>äºŒã€    React.memo()</h4><p>ç®€å•ç”¨æ³•å¦‚ä¸‹ï¼Œé€šè¿‡ <code>React.memo</code> åŒ…è£¹çš„ç»„ä»¶åœ¨ props ä¸å˜çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè¢«åŒ…è£¹çš„ç»„ä»¶æ˜¯ä¸ä¼šé‡æ–°æ¸²æŸ“çš„ï¼Œä¼šç›´æ¥å¤ç”¨æœ€è¿‘ä¸€æ¬¡æ¸²æŸ“çš„ç»“æœã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Child</span>(<span class="params">&#123;seconds&#125;</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;I am rendering&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;I am update every &#123;seconds&#125; seconds&lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> React.memo(Child)</span><br></pre></td></tr></table></figure>

<p>React.memo()å¯æ¥å—2ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºçº¯å‡½æ•°çš„ç»„ä»¶ï¼Œç¬¬äºŒä¸ªå‚æ•°ç”¨äºå¯¹æ¯”propsæ§åˆ¶æ˜¯å¦åˆ·æ–°ï¼Œä¸<a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://reactjs.org/docs/react-component.html%23shouldcomponentupdate">shouldComponentUpdate()</a>åŠŸèƒ½ç±»ä¼¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MyComponent = React.memo(<span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/* ä½¿ç”¨ props æ¸²æŸ“ */</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">areEqual</span>(<span class="params">prevProps, nextProps</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> isEqual(prevProps, nextProps); <span class="comment">//è¿™é‡Œæˆ‘ç”¨åˆ°lodashçš„isEqualæ–¹æ³•å»åˆ¤æ–­propsæ˜¯ä¸æ˜¯å®Œå…¨ç›¸ç­‰</span></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  å¦‚æœæŠŠ nextProps ä¼ å…¥ render æ–¹æ³•çš„è¿”å›ç»“æœä¸</span></span><br><span class="line"><span class="comment">  å°† prevProps ä¼ å…¥ render æ–¹æ³•çš„è¿”å›ç»“æœä¸€è‡´åˆ™è¿”å› trueï¼Œ</span></span><br><span class="line"><span class="comment">  å¦åˆ™è¿”å› false</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> React.memo(MyComponent, areEqual);</span><br></pre></td></tr></table></figure>

<p>â€‹        ä½¿ç”¨memoåï¼Œæˆ‘ä»¬å¦‚ä½•çŸ¥é“ç»„ä»¶é‡æ–°renderçš„æ¬¡æ•°å‘¢ï¼Ÿå¸¸ç”¨æ–¹æ³•console.logä¸€ä¸‹ï¼Œçœ‹çœ‹æ‰“å°æ¬¡æ•°ï¼Œè¿™é‡Œæˆ‘ä»¬å€ŸåŠ©<code>ahooks</code>åº“ä¸­çš„ä¸€äº›æ–¹æ³•ï¼Œæ¥å¾—çŸ¥å…·ä½“é‚£äº›å±æ€§å½±å“äº†render</p>
<p>â€‹        è¿™æ—¶ä¹ŸæŠ›å‡ºä¸€ä¸ªä¼˜åŒ–æ–¹æ³•ï¼š <strong>é¿å…å‘å­ç»„ä»¶ä¼ é€’ä¸€äº›æ— å…³çš„å±æ€§</strong></p>
<h4 id="ä¸‰ã€-ahooksä½¿ç”¨"><a href="#ä¸‰ã€-ahooksä½¿ç”¨" class="headerlink" title="ä¸‰ã€ ahooksä½¿ç”¨"></a>ä¸‰ã€ ahooksä½¿ç”¨</h4><p>â€‹        ahooks æ˜¯ä¸€ä¸ª React Hooks åº“ï¼Œè‡´åŠ›æä¾›å¸¸ç”¨ä¸”é«˜è´¨é‡çš„ Hooksã€‚å®ƒæä¾›äº†å¾ˆå¤šhookçš„å°è£…ï¼Œåœ¨è¿™é‡Œä¸åšè¿‡å¤šä»‹ç»ï¼Œç›´æ¥ä»è§£å†³å¤šæ¬¡renderè¿™ä¸ªé—®é¢˜å…¥æ‰‹ã€‚</p>
<ol>
<li><h5 id="useWhyDidYouUpdate-â€”-å¸®åŠ©å¼€å‘è€…æ’æŸ¥æ˜¯ä»€ä¹ˆæ”¹å˜å¯¼è‡´äº†ç»„ä»¶çš„renderã€‚-å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè§‚æµ‹ç»„ä»¶çš„åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå½“å‰ç»„ä»¶çš„propsã€‚æ‰“å¼€æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ°æ”¹å˜çš„-è¢«è§‚æµ‹çš„-state-æˆ–è€…-props-ç­‰è¾“å‡ºã€‚"><a href="#useWhyDidYouUpdate-â€”-å¸®åŠ©å¼€å‘è€…æ’æŸ¥æ˜¯ä»€ä¹ˆæ”¹å˜å¯¼è‡´äº†ç»„ä»¶çš„renderã€‚-å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè§‚æµ‹ç»„ä»¶çš„åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå½“å‰ç»„ä»¶çš„propsã€‚æ‰“å¼€æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ°æ”¹å˜çš„-è¢«è§‚æµ‹çš„-state-æˆ–è€…-props-ç­‰è¾“å‡ºã€‚" class="headerlink" title="useWhyDidYouUpdate â€” å¸®åŠ©å¼€å‘è€…æ’æŸ¥æ˜¯ä»€ä¹ˆæ”¹å˜å¯¼è‡´äº†ç»„ä»¶çš„renderã€‚    å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè§‚æµ‹ç»„ä»¶çš„åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå½“å‰ç»„ä»¶çš„propsã€‚æ‰“å¼€æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ°æ”¹å˜çš„ è¢«è§‚æµ‹çš„ state æˆ–è€… props ç­‰è¾“å‡ºã€‚"></a>useWhyDidYouUpdate â€” å¸®åŠ©å¼€å‘è€…æ’æŸ¥æ˜¯ä»€ä¹ˆæ”¹å˜å¯¼è‡´äº†ç»„ä»¶çš„renderã€‚    å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè§‚æµ‹ç»„ä»¶çš„åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå½“å‰ç»„ä»¶çš„propsã€‚æ‰“å¼€æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ°æ”¹å˜çš„ è¢«è§‚æµ‹çš„ <code>state</code> æˆ–è€… <code>props</code> ç­‰è¾“å‡ºã€‚</h5></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useWhyDidYouUpdate &#125; <span class="keyword">from</span> <span class="string">&#x27;ahooks&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> Demo: React.FC&lt;&#123; <span class="attr">count</span>: number &#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [randomNum, setRandomNum] = useState(<span class="built_in">Math</span>.random());</span><br><span class="line">  useWhyDidYouUpdate(<span class="string">&#x27;useWhyDidYouUpdateComponent&#x27;</span>, &#123; ...props, randomNum &#125;);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;span&gt;number: &#123;props.count&#125;&lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        randomNum: &#123;randomNum&#125;</span><br><span class="line">        &lt;button onClick=&#123;<span class="function">() =&gt;</span> setRandomNum(<span class="built_in">Math</span>.random)&#125; style=&#123;&#123; <span class="attr">marginLeft</span>: <span class="number">8</span> &#125;&#125;&gt;</span><br><span class="line">          ğŸ²</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> onDemo = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;Demo count=&#123;count&#125; onClick=&#123;onDemo&#125; /&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="function">() =&gt;</span> setCount(<span class="function">(<span class="params">prevCount</span>) =&gt;</span> prevCount - <span class="number">1</span>)&#125;&gt;count -&lt;/button&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="function">() =&gt;</span> setCount(<span class="function">(<span class="params">prevCount</span>) =&gt;</span> prevCount + <span class="number">1</span>)&#125; style=&#123;&#123; <span class="attr">marginLeft</span>: <span class="number">8</span> &#125;&#125;&gt;</span><br><span class="line">          count +</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;p&gt;Please open the browser <span class="built_in">console</span> to view the output!&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>â€‹        é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬å‘ç°ï¼Œç‚¹å‡»çˆ¶ç»„ä»¶æ”¹å˜countï¼Œå­ç»„ä»¶å°±ä¼šé‡æ–°renderï¼Œä½†æ˜¯æœ‰ä¸ªå¥‡æ€ªçš„é—®é¢˜å‡ºç°äº†ï¼Œä¸ºä»€ä¹ˆ<code>useWhyDidYouUpdate</code>æ‰“å°å‡ºæ¥çš„å½±å“æ¸²æŸ“çš„å±æ€§ä¸­ä¼šæœ‰onClickå‘¢ï¼Ÿè¿™ä¸ªé—®é¢˜å°±ä¼šå½’åˆ°å¼€ç¯‡æ‰€è¯´ç”±äºçˆ¶ç»„ä»¶çš„countå‘ç”Ÿäº†å˜åŒ–ï¼Œå¯¼è‡´äº†çˆ¶ç»„ä»¶çš„é‡ç»˜ä¹Ÿå°±æ˜¯renderï¼Œå‡½æ•°å¼ç»„ä»¶å°±ä¼šä»å¤´å¼€å§‹é‡æ–°æ‰§è¡Œå‡½æ•°è°ƒç”¨ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å†çˆ¶ç»„ä»¶å®šä¹‰çš„<code>onDemo</code>å‡½æ•°å°±ä¼šé‡æ–°è¢«å®šä¹‰ï¼Œæ­¤æ—¶æ–°ç”Ÿæˆçš„<code>onDemo</code>ä¸ä¹‹å‰ä¼ å…¥å­ç»„ä»¶çš„<code>onDemo</code>å¹¶ä¸æ˜¯ç›¸åŒçš„å‡½æ•°ã€‚åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­æ— æ³•é¿å…å‡½æ•°çš„å®šä¹‰ä¸ä¼ é€’ï¼Œé‚£ä¹ˆå¦‚ä½•åšä¼˜åŒ–å‘¢ï¼Ÿ    </p>
<p>â€‹        æˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„å¯èƒ½æ˜¯æŠŠç»„ä»¶å†…éƒ¨çš„å‡½æ•°å®šä¹‰åˆ°ç»„ä»¶å¤–ï¼Œå½“ç„¶è¿™ç§æ–¹æ³•ä¸€å®šå¯å–ï¼Œä½†æ˜¯åœ¨å‡½æ•°å†…è°ƒç”¨ä¸€äº›ç»„ä»¶å†…éƒ¨çš„æ–¹æ³•æˆ–å‚æ•°çš„æ—¶å€™å°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œè¿™æ—¶å€™å°±å¼•å‡ºä¸‹é¢è¿™ä¸ªæ–¹æ³•</p>
<ol start="2">
<li><h5 id="usePersistFn-â€”â€”-æŒä¹…åŒ–-function-çš„-Hookã€‚"><a href="#usePersistFn-â€”â€”-æŒä¹…åŒ–-function-çš„-Hookã€‚" class="headerlink" title="usePersistFn â€”â€” æŒä¹…åŒ– function çš„ Hookã€‚"></a>usePersistFn â€”â€” æŒä¹…åŒ– function çš„ Hookã€‚</h5><p>â€‹        åœ¨æŸäº›åœºæ™¯ä¸­ï¼Œä½ å¯èƒ½ä¼šéœ€è¦ç”¨ useCallback è®°ä½ä¸€ä¸ªå›è°ƒï¼Œä½†ç”±äºå†…éƒ¨å‡½æ•°å¿…é¡»ç»å¸¸é‡æ–°åˆ›å»ºï¼Œè®°å¿†æ•ˆæœä¸æ˜¯å¾ˆå¥½ï¼Œå¯¼è‡´å­ç»„ä»¶é‡å¤ renderã€‚å¯¹äºè¶…çº§å¤æ‚çš„å­ç»„ä»¶ï¼Œé‡æ–°æ¸²æŸ“ä¼šå¯¹æ€§èƒ½é€ æˆå½±å“ã€‚é€šè¿‡ usePersistFnï¼Œå¯ä»¥ä¿è¯å‡½æ•°åœ°å€æ°¸è¿œä¸ä¼šå˜åŒ–ã€‚å®ƒçš„ç”¨æ³•å¾ˆç®€å•ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">type noop = <span class="function">(<span class="params">...args: any[]</span>) =&gt;</span> any;</span><br><span class="line"><span class="keyword">const</span> fn = usePersistFn&lt;T <span class="keyword">extends</span> noop&gt;(</span><br><span class="line">  fn: T,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><code>usePersistFn</code>æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯ä½ éœ€è¦æŒä¹…åŒ–çš„å‡½æ•°ã€‚</p>
</li>
<li><h5 id="useSetState-â€”â€”-åˆ†ç»„ï¼Œåˆ†ç±»ç®¡ç†state"><a href="#useSetState-â€”â€”-åˆ†ç»„ï¼Œåˆ†ç±»ç®¡ç†state" class="headerlink" title="useSetState â€”â€” åˆ†ç»„ï¼Œåˆ†ç±»ç®¡ç†state"></a>useSetState â€”â€” åˆ†ç»„ï¼Œåˆ†ç±»ç®¡ç†state</h5><p>â€‹        ä¸ºä»€ä¹ˆæœ€åæåˆ°äº†è¿™ä¸ªæ–¹æ³•ï¼Ÿç»„ä»¶çš„æ¸²æŸ“æ ¹æœ¬åŸå› å°±æ˜¯stateçš„æ”¹å˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½¿ç”¨<code>useState</code>æ—¶ï¼ŒåŸºæœ¬ä¸Šä¼šå®šä¹‰å¾ˆå¤šå¦‚ä¸‹state</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [modelVisible, setModelVisible] = useState(<span class="literal">false</span>);</span><br><span class="line"><span class="keyword">const</span> [modelType, setModelType] = useState(<span class="string">&#x27;create&#x27;</span>);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>â€‹        å½“ç„¶ï¼Œä½¿ç”¨setStateæ—¶ä¹Ÿå¯ä»¥æŠŠä»–ä»¬å®šä¹‰åˆ°ä¸€å—ï¼Œä»¥<code>Object</code>çš„å½¢å¼æ¥å®šä¹‰ä¸€ä¸ªç»„ï¼Œä½†æ˜¯å¼Šç«¯æ˜¯æˆ‘ä»¬æ¯æ¬¡ä¿®æ”¹æŸä¸€ä¸ªå±æ€§éƒ½éœ€è¦æŠŠå…¶ä½™å±æ€§é‡æ–°å†™ä¸€è¾¹ï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚é‚£ä¹ˆuseSetStateå°±æœ‰å¿…è¦äº†</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [modelState, setModelState] = useSetState(&#123;</span><br><span class="line">	modelType: <span class="string">&#x27;create&#x27;</span>,</span><br><span class="line">	modelVisible: <span class="literal">false</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>â€‹        <strong>å›å½’æ­£é¢˜ï¼Œå°½å¯èƒ½å‡å°‘stateçš„å®šä¹‰ï¼Œä¹Ÿèƒ½è§£å†³ç»„ä»¶æœ¬èº«çš„renderï¼Œè¿™æ—¶å€™ä½¿ç”¨useSetStateä¼šéå¸¸æ–¹ä¾¿ã€‚</strong></p>
</li>
</ol>
<h4 id="å››ã€å°ç»“"><a href="#å››ã€å°ç»“" class="headerlink" title="å››ã€å°ç»“"></a>å››ã€å°ç»“</h4><p>é€šè¿‡ä»¥ä¸Šå†…å®¹æˆ‘ä»¬æ€»ç»“ä¸ºä¸€ä¸‹å‡ ç‚¹ï¼š        </p>
<ol>
<li><p><em><strong>å‡å°‘stateçš„å®šä¹‰</strong></em></p>
</li>
<li><p><em><strong>ä¼˜åŒ–ç»„ä»¶å†…éƒ¨å®šä¹‰çš„å‡½æ•°</strong></em></p>
</li>
<li><p><em><strong>ä¼˜åŒ–å­ç»„ä»¶çš„æ¸²æŸ“æœºåˆ¶</strong></em></p>
</li>
<li><p><em><strong>é¿å…å‘å­ç»„ä»¶ä¼ é€’ä¸å¿…è¦çš„å±æ€§</strong></em></p>
</li>
</ol>
<p>â€‹        å‰ç«¯æ¸²æŸ“æ€§èƒ½é—®é¢˜ç»å¤§å¤šæ•°æˆ‘ä»¬æ˜¯ä¸éœ€è¦è€ƒè™‘çš„ï¼Œä½†æ˜¯é¿å…ä¸äº†ä¸€äº›å¤æ‚é¡µé¢çš„å‡ºç°ã€‚é€šè¿‡ä»¥ä¸Šå†…å®¹ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šèƒ½è§£å†³æ‰ç»å¤§éƒ¨åˆ†çš„æ¸²æŸ“æ€§èƒ½é—®é¢˜ï¼Œå½“ç„¶è¿˜å­˜åœ¨å¾ˆå¤šä¼˜åŒ–çš„ç©ºé—´éœ€è¦æˆ‘ä»¬å»æ·±å…¥ç ”ç©¶ã€‚æœ¬æ–‡åªæä¾›ä¸€ä¸ªç®€å•å¯è¡Œçš„è§£å†³æ–¹æ¡ˆï¼Œå¸Œæœ›å¤§å®¶èƒ½ç ”ç©¶æ¢è®¨å‡ºæ›´å®Œç¾æ›´é«˜æ•ˆçš„ä¼˜åŒ–æ–¹æ¡ˆï¼</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.suner.work/2021/03/26/web%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/hook/" data-id="ckmq3yrjw0003tqgp7i0agqko" data-title="Reactæ€§èƒ½ä¼˜åŒ–â€”â€”hook" class="article-share-link">åˆ†äº«</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-webå‰ç«¯å¼€å‘/asyncã€await:è®©å¼‚æ­¥ç¼–ç¨‹æ›´ç®€å•" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/25/web%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/async%E3%80%81await:%E8%AE%A9%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E6%9B%B4%E7%AE%80%E5%8D%95/" class="article-date">
  <time class="dt-published" datetime="2021-03-25T01:18:24.165Z" itemprop="datePublished">2021-03-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/25/web%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/async%E3%80%81await:%E8%AE%A9%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E6%9B%B4%E7%AE%80%E5%8D%95/">asyncå’Œawait:è®©å¼‚æ­¥ç¼–ç¨‹æ›´ç®€å•</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="asyncå…³é”®å­—"><a href="#asyncå…³é”®å­—" class="headerlink" title="asyncå…³é”®å­—"></a>asyncå…³é”®å­—</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨asyncå…³é”®å­—ï¼Œæ‚¨å¯ä»¥å°†å®ƒæ”¾åœ¨å‡½æ•°å£°æ˜ä¹‹å‰ï¼Œå°†å…¶è½¬æ¢ä¸ºasync functionã€‚å¼‚æ­¥å‡½æ•°æ˜¯ä¸€ä¸ªçŸ¥é“æ€æ ·é¢„æœŸ await å…³é”®å­—å¯ç”¨äºè°ƒç”¨å¼‚æ­¥ä»£ç å¯èƒ½æ€§çš„å‡½æ•°ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">async function hello() &#123; return &quot;Hello&quot; &#125;;</span><br><span class="line">hello();</span><br></pre></td></tr></table></figure>

<p>è¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªpromiseã€‚è¿™æ˜¯å¼‚æ­¥å‡½æ•°çš„ç‰¹å¾ä¹‹ä¸€ â€“â€“å®ƒå°†ä»»ä½•å‡½æ•°è½¬æ¢ä¸ºpromiseã€‚å› ä¸ºå®ƒè¿”å›äº†ä¸€ä¸ªpromiseï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨.thenï¼ˆï¼‰</p>
<p><code>hello().then((value) =&gt; console.log(value))</code></p>
<p>å°†asyncå…³é”®å­—æ·»åŠ åˆ°å‡½æ•°ä¸­ä»¥å‘Šè¯‰å®ƒä»¬è¿”å›promiseè€Œä¸æ˜¯ç›´æ¥è¿”å›å€¼ã€‚æ­¤å¤–ï¼Œè¿™ä½¿åŒæ­¥å‡½æ•°å¯ä»¥é¿å…è¿è¡Œæ”¯æŒä½¿ç”¨awaitæ—¶å¸¦æ¥çš„ä»»ä½•æ½œåœ¨å¼€é”€ã€‚é€šè¿‡ä»…åœ¨å‡½æ•°å£°æ˜ä¸ºå¼‚æ­¥æ—¶æ·»åŠ å¿…è¦çš„å¤„ç†ï¼ŒJavaScriptå¼•æ“å¯ä»¥ä¸ºæ‚¨ä¼˜åŒ–æ‚¨çš„ç¨‹åºã€‚</p>
<h2 id="awaitå…³é”®å­—"><a href="#awaitå…³é”®å­—" class="headerlink" title="awaitå…³é”®å­—"></a>awaitå…³é”®å­—</h2><p>asyncä¸awaitå…³é”®å­—ç»“åˆä½¿ç”¨æ—¶ï¼Œå¼‚æ­¥å‡½æ•°çš„çœŸæ­£ä¼˜åŠ¿å°±å˜å¾—æ˜æ˜¾äº†ã€‚è¿™å¯ä»¥æ”¾åœ¨ä»»ä½•åŸºäºå¼‚æ­¥å£°æ˜çš„å‡½æ•°ä¹‹å‰ï¼Œæš‚åœä»£ç åœ¨è¯¥è¡Œä¸Šï¼Œç›´åˆ°promiseå®Œæˆï¼Œç„¶åè¿”å›ç»“æœå€¼ã€‚ä¸æ­¤åŒæ—¶ï¼Œå…¶ä»–æ­£åœ¨ç­‰å¾…æ‰§è¡Œæœºä¼šçš„ä»£ç å°±æœ‰å¯èƒ½å¦‚æ„¿æ‰§è¡Œäº†</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">async function hello() &#123;</span><br><span class="line">  return greeting &#x3D; await Promise.resolve(&quot;Hello&quot;);</span><br><span class="line">&#125;;</span><br><span class="line">hello().then(alert);</span><br></pre></td></tr></table></figure>

<h2 id="ä¸ºä»€ä¹ˆAsync-Awaitæ›´å¥½ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆAsync-Awaitæ›´å¥½ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆAsync/Awaitæ›´å¥½ï¼Ÿ"></a>ä¸ºä»€ä¹ˆAsync/Awaitæ›´å¥½ï¼Ÿ</h2><ul>
<li>ç®€æ´</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fetch(&#39;coffee.jpg&#39;)</span><br><span class="line">.then(response &#x3D;&gt; response.blob())</span><br><span class="line">.then(myBlob &#x3D;&gt; &#123;</span><br><span class="line">  let objectURL &#x3D; URL.createObjectURL(myBlob);</span><br><span class="line">  let image &#x3D; document.createElement(&#39;img&#39;);</span><br><span class="line">  image.src &#x3D; objectURL;</span><br><span class="line">  document.body.appendChild(image);</span><br><span class="line">&#125;)</span><br><span class="line">.catch(e &#x3D;&gt; &#123;</span><br><span class="line">  console.log(&#39;There has been a problem with your fetch operation: &#39; + e.message);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>è®©æˆ‘ä»¬æŠŠå®ƒè½¬æ¢ä¸ºä½¿ç”¨async / awaitæ¥çœ‹çœ‹å®ƒåšèµ·æ¥æœ‰å¤šä¹ˆç®€å•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">async function myFetch() &#123;</span><br><span class="line">  let response &#x3D; await fetch(&#39;coffee.jpg&#39;);</span><br><span class="line">  let myBlob &#x3D; await response.blob();</span><br><span class="line"></span><br><span class="line">  let objectURL &#x3D; URL.createObjectURL(myBlob);</span><br><span class="line">  let image &#x3D; document.createElement(&#39;img&#39;);</span><br><span class="line">  image.src &#x3D; objectURL;</span><br><span class="line">  document.body.appendChild(image);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myFetch()</span><br><span class="line">.catch(e &#x3D;&gt; &#123;</span><br><span class="line">  console.log(&#39;There has been a problem with your fetch operation: &#39; + e.message);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>ç”±ç¤ºä¾‹å¯çŸ¥ï¼Œä½¿ç”¨Async/Awaitæ˜æ˜¾èŠ‚çº¦äº†ä¸å°‘ä»£ç ã€‚æˆ‘ä»¬ä¸éœ€è¦å†™.thenï¼Œä¸éœ€è¦å†™åŒ¿åå‡½æ•°å¤„ç†Promiseçš„resolveå€¼ï¼Œä¹Ÿä¸éœ€è¦å®šä¹‰å¤šä½™çš„dataå˜é‡ï¼Œè¿˜é¿å…äº†åµŒå¥—ä»£ç ã€‚è¿™äº›å°çš„ä¼˜ç‚¹ä¼šè¿…é€Ÿç´¯è®¡èµ·æ¥ï¼Œè¿™åœ¨ä¹‹åçš„ä»£ç ç¤ºä¾‹ä¸­ä¼šæ›´åŠ æ˜æ˜¾ã€‚</p>
<ul>
<li>é”™è¯¯å¤„ç†<br>æ‚¨å¯ä»¥åœ¨async / awaitä½¿ç”¨åŒæ­¥çš„tryâ€¦catchç»“æ„;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">async function myFetch() &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    let response &#x3D; await fetch(&#39;coffee.jpg&#39;);</span><br><span class="line">    let myBlob &#x3D; await response.blob();</span><br><span class="line"></span><br><span class="line">    let objectURL &#x3D; URL.createObjectURL(myBlob);</span><br><span class="line">    let image &#x3D; document.createElement(&#39;img&#39;);</span><br><span class="line">    image.src &#x3D; objectURL;</span><br><span class="line">    document.body.appendChild(image);</span><br><span class="line">  &#125; catch(e) &#123;</span><br><span class="line">    console.log(e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myFetch();</span><br></pre></td></tr></table></figure>

<p>catchï¼ˆï¼‰{}ä»£ç å—ä¼šæ”¶åˆ°ä¸€ä¸ªé”™è¯¯å¯¹è±¡ï¼Œe; æˆ‘ä»¬ç°åœ¨å¯ä»¥å°†å…¶è®°å½•åˆ°æ§åˆ¶å°ï¼Œå®ƒå°†å‘æˆ‘ä»¬æä¾›è¯¦ç»†çš„é”™è¯¯æ¶ˆæ¯ï¼Œæ˜¾ç¤ºé”™è¯¯è¢«æŠ›å‡ºçš„ä»£ç ä¸­çš„ä½ç½®ã€‚</p>
<ul>
<li>æ¡ä»¶è¯­å¥</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const makeRequest &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">  return getJSON()</span><br><span class="line">    .then(data &#x3D;&gt; &#123;</span><br><span class="line">      if (data.needsAnotherRequest) &#123;</span><br><span class="line">        return makeAnotherRequest(data)</span><br><span class="line">          .then(moreData &#x3D;&gt; &#123;</span><br><span class="line">            console.log(moreData)</span><br><span class="line">            return moreData</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        console.log(data)</span><br><span class="line">        return data</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¢ç”¨async/awaitç¼–å†™</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const makeRequest &#x3D; async () &#x3D;&gt; &#123;</span><br><span class="line">  const data &#x3D; await getJSON()</span><br><span class="line">  if (data.needsAnotherRequest) &#123;</span><br><span class="line">    const moreData &#x3D; await makeAnotherRequest(data);</span><br><span class="line">    console.log(moreData)</span><br><span class="line">    return moreData</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    console.log(data)</span><br><span class="line">    return data    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¸­é—´å€¼</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const makeRequest &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">  return promise1()</span><br><span class="line">    .then(value1 &#x3D;&gt; &#123;</span><br><span class="line">      return promise2(value1)</span><br><span class="line">        .then(value2 &#x3D;&gt; &#123;        </span><br><span class="line">          return promise3(value1, value2)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¢ç”¨async/awaitç¼–å†™</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const makeRequest &#x3D; async () &#x3D;&gt; &#123;</span><br><span class="line">  const value1 &#x3D; await promise1()</span><br><span class="line">  const value2 &#x3D; await promise2(value1)</span><br><span class="line">  return promise3(value1, value2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ç­‰å¾…Promise.all()</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">async function fetchAndDecode(url, type) &#123;</span><br><span class="line">  let response &#x3D; await fetch(url);</span><br><span class="line"></span><br><span class="line">  let content;</span><br><span class="line"></span><br><span class="line">  if(type &#x3D;&#x3D;&#x3D; &#39;blob&#39;) &#123;</span><br><span class="line">    content &#x3D; await response.blob();</span><br><span class="line">  &#125; else if(type &#x3D;&#x3D;&#x3D; &#39;text&#39;) &#123;</span><br><span class="line">    content &#x3D; await response.text();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return content;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function displayContent() &#123;</span><br><span class="line">  let coffee &#x3D; fetchAndDecode(&#39;coffee.jpg&#39;, &#39;blob&#39;);</span><br><span class="line">  let tea &#x3D; fetchAndDecode(&#39;tea.jpg&#39;, &#39;blob&#39;);</span><br><span class="line">  let description &#x3D; fetchAndDecode(&#39;description.txt&#39;, &#39;text&#39;);</span><br><span class="line"></span><br><span class="line">  let values &#x3D; await Promise.all([coffee, tea, description]);</span><br><span class="line"></span><br><span class="line">  let objectURL1 &#x3D; URL.createObjectURL(values[0]);</span><br><span class="line">  let objectURL2 &#x3D; URL.createObjectURL(values[1]);</span><br><span class="line">  let descText &#x3D; values[2];</span><br><span class="line"></span><br><span class="line">  let image1 &#x3D; document.createElement(&#39;img&#39;);</span><br><span class="line">  let image2 &#x3D; document.createElement(&#39;img&#39;);</span><br><span class="line">  image1.src &#x3D; objectURL1;</span><br><span class="line">  image2.src &#x3D; objectURL2;</span><br><span class="line">  document.body.appendChild(image1);</span><br><span class="line">  document.body.appendChild(image2);</span><br><span class="line"></span><br><span class="line">  let para &#x3D; document.createElement(&#39;p&#39;);</span><br><span class="line">  para.textContent &#x3D; descText;</span><br><span class="line">  document.body.appendChild(para);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">displayContent()</span><br><span class="line">.catch((e) &#x3D;&gt;</span><br><span class="line">  console.log(e)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œé€šè¿‡ä½¿ç”¨awaitï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨valuesæ•°ç»„ä¸­çš„ä¸‰ä¸ªpromiseçš„ç»“æœéƒ½å¯ç”¨çš„æ—¶å€™è·å¾—å®ƒä»¬ï¼Œä»¥ä¸€ç§çœ‹èµ·æ¥éå¸¸åƒåŒæ­¥ä»£ç çš„æ–¹å¼ã€‚æˆ‘ä»¬éœ€è¦å°†æ‰€æœ‰ä»£ç å°è£…åœ¨ä¸€ä¸ªæ–°çš„å¼‚æ­¥å‡½æ•°displayContentï¼ˆï¼‰ä¸­ï¼Œä¹Ÿæ²¡æœ‰è¯´å‡å°‘äº†å¾ˆå¤šè¡Œä»£ç ï¼Œä½†èƒ½å¤Ÿå°†å¤§éƒ¨åˆ†ä»£ç ä».thenï¼ˆï¼‰ ä»£ç å—ç§»å‡ºï¼Œä»£ç å¾—åˆ°äº†ç®€åŒ–ï¼Œå¾—åˆ°çš„æ˜¯ä¸€ä¸ªæ›´æ˜“è¯»çš„ç¨‹åºã€‚</p>
<p>å¯¹äºé”™è¯¯å¤„ç†ï¼Œæˆ‘ä»¬åœ¨displayContentï¼ˆï¼‰è°ƒç”¨ä¸­åŒ…å«äº†ä¸€ä¸ª.catchï¼ˆï¼‰ä»£ç å—;è¿™å°†å¤„ç†ä¸¤ä¸ªå‡½æ•°ä¸­å‡ºç°çš„é”™è¯¯ã€‚</p>
<p>##async/awaitçš„ç¼ºé™·<br>Async/awaitè®©ä½ çš„ä»£ç çœ‹èµ·æ¥æ˜¯åŒæ­¥çš„ï¼Œåœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œä¹Ÿä½¿å¾—å®ƒçš„è¡Œä¸ºæ›´åŠ åœ°åŒæ­¥ã€‚ awaitå…³é”®å­—ä¼šé˜»å¡å…¶åçš„ä»£ç ï¼Œç›´åˆ°promiseå®Œæˆï¼Œå°±åƒæ‰§è¡ŒåŒæ­¥æ“ä½œä¸€æ ·ã€‚å®ƒç¡®å®å¯ä»¥å…è®¸å…¶ä»–ä»»åŠ¡åœ¨æ­¤æœŸé—´ç»§ç»­è¿è¡Œï¼Œä½†æ‚¨è‡ªå·±çš„ä»£ç è¢«é˜»å¡ã€‚</p>
<p>è¿™æ„å‘³ç€æ‚¨çš„ä»£ç å¯èƒ½ä¼šå› ä¸ºå¤§é‡awaitçš„promisesç›¸ç»§å‘ç”Ÿè€Œå˜æ…¢ã€‚æ¯ä¸ªawaitéƒ½ä¼šç­‰å¾…å‰ä¸€ä¸ªå®Œæˆï¼Œè€Œä½ å®é™…æƒ³è¦çš„æ˜¯æ‰€æœ‰çš„è¿™äº›promisesåŒæ—¶å¼€å§‹å¤„ç†ï¼ˆå°±åƒæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨async/awaitæ—¶é‚£æ ·ï¼‰ã€‚</p>
<p>æœ‰ä¸€ç§æ¨¡å¼å¯ä»¥ç¼“è§£è¿™ä¸ªé—®é¢˜ â€“â€“é€šè¿‡å°†Promiseå¯¹è±¡å­˜å‚¨åœ¨å˜é‡ä¸­æ¥åŒæ—¶å¼€å§‹å®ƒä»¬ï¼Œç„¶åç­‰å¾…å®ƒä»¬å…¨éƒ¨æ‰§è¡Œå®Œæ¯•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">function timeoutPromise(interval) &#123;</span><br><span class="line">  return new Promise((resolve, reject) &#x3D;&gt; &#123;</span><br><span class="line">    setTimeout(function()&#123;</span><br><span class="line">      resolve(&quot;done&quot;);</span><br><span class="line">    &#125;, interval);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">async function timeTest() &#123;</span><br><span class="line">  const timeoutPromise1 &#x3D; timeoutPromise(3000);</span><br><span class="line">  const timeoutPromise2 &#x3D; timeoutPromise(3000);</span><br><span class="line">  const timeoutPromise3 &#x3D; timeoutPromise(3000);</span><br><span class="line"></span><br><span class="line">  await timeoutPromise1;</span><br><span class="line">  await timeoutPromise2;</span><br><span class="line">  await timeoutPromise3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let startTime &#x3D; Date.now();</span><br><span class="line">timeTest().then(() &#x3D;&gt; &#123;</span><br><span class="line">  let finishTime &#x3D; Date.now();</span><br><span class="line">  let timeTaken &#x3D; finishTime - startTime;</span><br><span class="line">  alert(&quot;Time taken in milliseconds: &quot; + timeTaken);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä¸‰ä¸ªPromiseå¯¹è±¡å­˜å‚¨åœ¨å˜é‡ä¸­ï¼Œè¿™æ ·å¯ä»¥åŒæ—¶å¯åŠ¨å®ƒä»¬å…³è”çš„è¿›ç¨‹ã€‚</p>
<p>##Async/await çš„ç±»æ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">class Person &#123;</span><br><span class="line">  constructor(first, last, age, gender, interests) &#123;</span><br><span class="line">    this.name &#x3D; &#123;</span><br><span class="line">      first,</span><br><span class="line">      last</span><br><span class="line">    &#125;;</span><br><span class="line">    this.age &#x3D; age;</span><br><span class="line">    this.gender &#x3D; gender;</span><br><span class="line">    this.interests &#x3D; interests;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  async greeting() &#123;</span><br><span class="line">    return await Promise.resolve(&#96;Hi! I&#39;m $&#123;this.name.first&#125;&#96;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  farewell() &#123;</span><br><span class="line">    console.log(&#96;$&#123;this.name.first&#125; has left the building. Bye for now!&#96;);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let han &#x3D; new Person(&#39;Han&#39;, &#39;Solo&#39;, 25, &#39;male&#39;, [&#39;Smuggling&#39;]);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">han.greeting().then(console.log);</span><br></pre></td></tr></table></figure>

<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>   Async/Awaitæ˜¯è¿‘å¹´æ¥JavaScriptæ·»åŠ çš„æœ€é©å‘½æ€§çš„çš„ç‰¹æ€§ä¹‹ä¸€ã€‚å®ƒä¼šè®©ä½ å‘ç°Promiseçš„è¯­æ³•æœ‰å¤šç³Ÿç³•ï¼Œè€Œä¸”æä¾›äº†ä¸€ä¸ªç›´è§‚çš„æ›¿ä»£æ–¹æ³•ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.suner.work/2021/03/25/web%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/async%E3%80%81await:%E8%AE%A9%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E6%9B%B4%E7%AE%80%E5%8D%95/" data-id="ckmq43c270004tqgphrd90lyx" data-title="asyncå’Œawait:è®©å¼‚æ­¥ç¼–ç¨‹æ›´ç®€å•" class="article-share-link">åˆ†äº«</a>
      
      
      
    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">å½’æ¡£</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">ä¸‰æœˆ 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æœ€æ–°æ–‡ç« </h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/26/web%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/hook/">Reactæ€§èƒ½ä¼˜åŒ–â€”â€”hook</a>
          </li>
        
          <li>
            <a href="/2021/03/25/web%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/async%E3%80%81await:%E8%AE%A9%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E6%9B%B4%E7%AE%80%E5%8D%95/">asyncå’Œawait:è®©å¼‚æ­¥ç¼–ç¨‹æ›´ç®€å•</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 mazhaoxian<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>